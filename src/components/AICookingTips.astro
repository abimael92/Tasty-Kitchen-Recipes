---
import { t } from '../utils/i18n.js';
import cookingTips from '../data/cooking-tips.json';

const { currentLocale = 'es' } = Astro.props;
const randomIndex = Math.floor(Math.random() * cookingTips.tips.length);
const tip = cookingTips.tips[randomIndex];
const displayTip = currentLocale === 'es' ? tip.es : tip.en;
---

<section class='ai-tips-section'>
	<div class='tip-header'>
		<div class='tip-icon'>
			<!-- Chef Hat SVG -->

			<svg
				version='1.1'
				id='Layer_1'
				xmlns='http://www.w3.org/2000/svg'
				xmlns:xlink='http://www.w3.org/1999/xlink'
				viewBox='0 0 511.988 511.988'
				xml:space='preserve'
				fill='#000000'
				><g id='SVGRepo_bgCarrier' stroke-width='0'></g><g
					id='SVGRepo_tracerCarrier'
					stroke-linecap='round'
					stroke-linejoin='round'></g><g id='SVGRepo_iconCarrier'>
					<path
						style='fill:#323030;'
						d='M434.146,402.383l-1.562-0.453c-23.094-6.203-30.906-12.172-41.188-16.078 c-36.467-13.891-45.967-23.906-48.389-28.641c-0.078-0.156-0.156-0.344-0.234-0.516l-0.297-42.357l-86.482-0.985l-86.482,0.984 l-0.297,42.357c-0.078,0.172-0.148,0.359-0.234,0.516c-2.43,4.734-11.914,14.75-48.381,28.641 c-10.281,3.906-18.094,9.875-41.187,16.078l-1.578,0.453c-21.023,6.951-35.164,26.436-35.164,48.436v61.17h213.323h213.322v-61.17 C469.316,428.818,455.178,409.334,434.146,402.383z'
					></path>
					<rect
						x='169.514'
						y='314.334'
						style='fill:#A18D82;'
						width='173.26'
						height='128.15'></rect>
					<path
						style='fill:#CEB4a5;'
						d='M375.992,232.37c0,77.968-74.326,149.731-119.998,149.731c-45.671,0-120.005-71.764-120.005-149.731 s53.733-129.403,120.005-129.403C322.273,102.967,375.992,154.403,375.992,232.37z'
					></path>
					<g>
						<path
							style='fill:#292523;'
							d='M324.039,265.744c13.078-4.016,24.766,5.391,9.703,13.516 c-30.375,16.391-53.264-45.265-79.005-13.047c-25.734,32.219,15.281,64.701,52.005,61.326 c99.904-9.188,57.641-77.794,38.703-77.216C330.992,250.76,324.039,265.744,324.039,265.744z'
						></path>
						<path
							style='fill:#292523;'
							d='M187.949,265.744c-13.085-4.016-24.773,5.391-9.71,13.516 c30.382,16.391,53.272-45.265,79.013-13.047c25.742,32.219-15.28,64.701-52.006,61.326c-99.904-9.188-57.639-77.794-38.702-77.216 C181.004,250.76,187.949,265.744,187.949,265.744z'
						></path>
					</g>
					<path
						style='fill:#403E3E;'
						d='M146.661,202.667v-64.92l-7.234-2.453c-25.976-8.812-43.429-33.187-43.429-60.624 c0-35.296,28.71-63.998,63.999-63.998c15.5,0,30.444,5.609,42.1,15.796c11.539,10.078-0.476-1.484,1.68,13.609l24-20.671 l56.999-2.828l21.17,17c2.156-15.093,3.078,2.968,14.609-7.109c11.656-10.187,26.609-15.796,42.109-15.796 c35.295,0,63.982,28.702,63.982,63.998c0,31-22.094,57.483-52.545,62.968l-8.766,1.594v63.436H146.661V202.667z'
					></path>
					<path
						style='fill:#323030;'
						d='M362.664,0c-20.891,0-39.797,8.578-53.328,22.422C295.775,8.594,276.9,0,255.994,0 c-18.281,0-35.022,6.578-48.007,17.484C195.011,6.578,178.277,0,159.996,0c-41.233,0-74.663,33.421-74.663,74.67 c0,32.828,21.203,60.718,50.663,70.717v67.936h239.995v-65.186c34.873-6.281,61.342-36.78,61.342-73.467 C437.334,33.422,403.896,0,362.664,0z M403.428,109.045c-8,9.484-19.094,15.921-31.217,18.109l-17.547,3.156v17.828v43.858H157.325 v-46.608v-15.296l-14.477-4.906c-21.64-7.344-36.179-27.64-36.179-50.515c0-29.405,23.921-53.342,53.327-53.342 c12.343,0,24.265,4.281,33.772,12.078c-7.859,11.812-12.437,26-12.437,41.264c0,5.891,4.773,10.656,10.664,10.656 s10.664-4.766,10.664-10.656c0-29.405,23.929-53.342,53.335-53.342s53.341,23.937,53.341,53.342l0,0 c0,5.891,4.766,10.656,10.656,10.656s10.672-4.766,10.672-10.656c0-0.031-0.016-0.047-0.016-0.062c0-12.499-3.078-24.265-8.5-34.608 c1.656-1.953,3.469-3.797,5.438-5.516c9.703-8.484,22.156-13.155,35.078-13.155c29.404,0,53.326,23.937,53.326,53.342 C415.99,87.248,411.521,99.452,403.428,109.045z'
					></path>
					<path
						style='fill:#612324;'
						d='M255.994,511.988h87.013V357.211c0,0-45.467,51.045-87.013,51.045s-86.779-51.561-86.779-51.561 v155.293L255.994,511.988L255.994,511.988z'
					></path>
					<g>
						<path
							style='fill:#323030;'
							d='M234.667,437.318c0,5.891-4.781,10.672-10.672,10.672c-5.89,0-10.664-4.781-10.664-10.672 s4.773-10.656,10.664-10.656C229.886,426.662,234.667,431.428,234.667,437.318z'
						></path>
						<path
							style='fill:#323030;'
							d='M234.667,479.99c0,5.889-4.781,10.67-10.672,10.67c-5.89,0-10.664-4.781-10.664-10.67 c0-5.891,4.773-10.672,10.664-10.672C229.886,469.318,234.667,474.099,234.667,479.99z'
						></path>
						<path
							style='fill:#323030;'
							d='M298.666,437.318c0,5.891-4.781,10.672-10.672,10.672s-10.656-4.781-10.656-10.672 s4.766-10.656,10.656-10.656S298.666,431.428,298.666,437.318z'
						></path>
						<path
							style='fill:#323030;'
							d='M298.666,479.99c0,5.889-4.781,10.67-10.672,10.67s-10.656-4.781-10.656-10.67 c0-5.891,4.766-10.672,10.656-10.672S298.666,474.099,298.666,479.99z'
						></path>
					</g>
				</g></svg
			>
		</div>
		<div class='tip-title'>
			<h3>{t('aiCookingTips.title', currentLocale)}</h3>
			<span class='tip-badge'>
				<svg
					xmlns='http://www.w3.org/2000/svg'
					width='12'
					height='12'
					fill='currentColor'
					viewBox='0 0 16 16'
				>
					<path
						d='M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z'
					></path>
					<path
						d='M8 13A5 5 0 1 1 8 3a5 5 0 0 1 0 10zm0 1A6 6 0 1 0 8 2a6 6 0 0 0 0 12z'
					></path>
					<circle cx='8' cy='8' r='2'></circle>
				</svg>
				AI
			</span>
		</div>
	</div>

	<div class='tip-content'>
		<div class='tip-text-wrapper'>
			<div class='quote-mark start'>"</div>
			<p id='tip-text' class='tip-text-animate'>{displayTip}</p>
			<div class='quote-mark end'>"</div>
		</div>

		<button class='new-tip-btn' id='new-tip-button'>
			<span class='btn-icon'>
				<svg
					xmlns='http://www.w3.org/2000/svg'
					width='20'
					height='20'
					fill='currentColor'
					viewBox='0 0 24 24'
				>
					<path d='M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z'></path>
					<path d='M0 0h24v24H0z' fill='none'></path>
				</svg>
			</span>
			<span class='btn-text'>{t('aiCookingTips.newTip', currentLocale)}</span>
			<span class='btn-spinner' style='display: none;'>
				<svg
					xmlns='http://www.w3.org/2000/svg'
					width='16'
					height='16'
					fill='currentColor'
					viewBox='0 0 24 24'
				>
					<path
						d='M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z'
						opacity='.25'></path>
					<path
						d='M10.72,19.9a8,8,0,0,1-6.5-9.79A7.77,7.77,0,0,1,10.4,4.16a8,8,0,0,1,9.49,6.52A1.54,1.54,0,0,0,21.38,12h.13a1.37,1.37,0,0,0,1.38-1.54,11,11,0,1,0-12.53,12.53A1.54,1.54,0,0,0,12,21.38h0A1.47,1.47,0,0,0,10.72,19.9Z'
					>
						<animateTransform
							attributeName='transform'
							type='rotate'
							dur='0.75s'
							values='0 12 12;360 12 12'
							repeatCount='indefinite'></animateTransform>
					</path>
				</svg>
			</span>
		</button>
	</div>
</section>

<script define:vars={{ tips: cookingTips.tips, currentLocale }}>
	function getNewTip() {
		const button = document.getElementById('new-tip-button');
		const text = document.getElementById('tip-text');
		const btnText = button.querySelector('.btn-text');
		const btnIcon = button.querySelector('.btn-icon');
		const btnSpinner = button.querySelector('.btn-spinner');

		// Disable button and show spinner
		button.disabled = true;
		btnText.style.opacity = '0.5';
		btnIcon.style.display = 'none';
		btnSpinner.style.display = 'inline-block';

		// Add tip animation
		text.classList.add('tip-text-out');

		setTimeout(() => {
			const randomIndex = Math.floor(Math.random() * tips.length);
			const tip = tips[randomIndex];
			const displayTip = currentLocale === 'es' ? tip.es : tip.en;

			text.textContent = displayTip;
			text.classList.remove('tip-text-out');
			text.classList.add('tip-text-in');

			// Button animation
			setTimeout(() => {
				text.classList.remove('tip-text-in');
				button.disabled = false;
				btnText.style.opacity = '1';
				btnIcon.style.display = 'inline-block';
				btnSpinner.style.display = 'none';

				// Add confetti effect
				createConfetti();
			}, 300);
		}, 300);
	}

	function createConfetti() {
		const colors = ['#d2691e', '#c14e39', '#ff8c42', '#ff6b35'];
		const confettiCount = 8;

		for (let i = 0; i < confettiCount; i++) {
			const confetti = document.createElement('div');
			confetti.className = 'confetti';
			confetti.style.background =
				colors[Math.floor(Math.random() * colors.length)];
			confetti.style.left = `${Math.random() * 100}%`;
			confetti.style.width = `${Math.random() * 8 + 4}px`;
			confetti.style.height = confetti.style.width;
			confetti.style.animationDelay = `${Math.random() * 0.5}s`;

			document.querySelector('.ai-tips-section').appendChild(confetti);

			setTimeout(() => confetti.remove(), 1000);
		}
	}

	document.addEventListener('DOMContentLoaded', () => {
		const button = document.getElementById('new-tip-button');
		if (button) {
			button.addEventListener('click', getNewTip);

			// Add hover sound effect (optional)
			button.addEventListener('mouseenter', () => {
				const audio = new Audio(
					'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA=='
				);
				audio.volume = 0.1;
				audio.play(); // Uncomment if you want sound
			});
		}
	});
</script>

<style>
	.ai-tips-section {
		margin: 2.5rem 4rem;
		padding: 1rem;
		background: linear-gradient(145deg, #fffaf5 0%, #fff1e6 100%);
		border-radius: 20px;
		border: 2px solid rgba(209, 105, 30, 0.12);
		box-shadow:
			0 10px 40px rgba(209, 105, 30, 0.1),
			0 2px 8px rgba(0, 0, 0, 0.04),
			inset 0 1px 0 rgba(255, 255, 255, 0.8);
		position: relative;
		overflow: hidden;
		transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.ai-tips-section:hover {
		transform: translateY(-2px);
		box-shadow:
			0 15px 50px rgba(209, 105, 30, 0.15),
			0 4px 12px rgba(0, 0, 0, 0.06),
			inset 0 1px 0 rgba(255, 255, 255, 0.9);
		border-color: rgba(209, 105, 30, 0.2);
	}

	.ai-tips-section::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		height: 5px;
		background: linear-gradient(
			90deg,
			var(--color-primary) 0%,
			#ff8c42 25%,
			#ff6b35 50%,
			#ff8c42 75%,
			var(--color-secondary) 100%
		);
		background-size: 200% 100%;
		animation: gradient-shift 3s ease infinite;
		border-radius: 20px 20px 0 0;
	}

	@keyframes gradient-shift {
		0% {
			background-position: 0% 50%;
		}
		50% {
			background-position: 100% 50%;
		}
		100% {
			background-position: 0% 50%;
		}
	}

	.tip-header {
		display: flex;
		align-items: center;
		gap: 1rem;
		margin-bottom: 1.5rem;
		padding-bottom: 1.25rem;
		border-bottom: 2px dashed rgba(209, 105, 30, 0.15);
	}

	.tip-icon {
		width: 60px;
		height: 60px;
		background: radial-gradient(circle at center, #ffffff 0%, #612324 90%);
		border-radius: 16px;
		display: flex;
		align-items: center;
		justify-content: center;
		flex-shrink: 0;
		box-shadow:
			0 8px 20px rgba(209, 105, 30, 0.25),
			inset 0 -2px 4px rgba(0, 0, 0, 0.1),
			inset 0 2px 4px rgba(255, 255, 255, 0.3);
		position: relative;
		transition: all 0.3s ease;
	}

	.tip-icon:hover {
		transform: scale(1.05) rotate(5deg);
		box-shadow:
			0 12px 25px rgba(209, 105, 30, 0.35),
			inset 0 -2px 4px rgba(0, 0, 0, 0.1),
			inset 0 2px 4px rgba(255, 255, 255, 0.4);
	}

	.tip-icon svg {
		width: 32px;
		height: 32px;
		color: white;
		filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
	}

	.tip-title {
		flex: 1;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 1rem;
	}

	.ai-tips-section h3 {
		font-family: var(--font-heading);
		color: var(--color-primary);
		margin: 0;
		font-size: 1.75rem;
		font-weight: 800;
		letter-spacing: -0.02em;
		text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	}

	.tip-badge {
		background: linear-gradient(135deg, #ff6b35, #ff8c42);
		color: white;
		padding: 0.25rem 0.5rem;
		border-radius: 12px;
		font-size: 0.85rem;
		font-weight: 700;
		letter-spacing: 0.08em;
		text-transform: uppercase;
		display: flex;
		align-items: center;
		gap: 0.5rem;
		box-shadow:
			0 4px 12px rgba(255, 107, 53, 0.3),
			0 1px 3px rgba(0, 0, 0, 0.1);
		transition: all 0.3s ease;
		border: 1px solid rgba(255, 255, 255, 0.2);
	}

	.tip-badge:hover {
		transform: translateY(-1px);
		box-shadow:
			0 6px 16px rgba(255, 107, 53, 0.4),
			0 2px 4px rgba(0, 0, 0, 0.1);
	}

	.tip-badge svg {
		width: 14px;
		height: 14px;
		animation: pulse 2s infinite;
	}

	@keyframes pulse {
		0%,
		100% {
			opacity: 1;
		}
		50% {
			opacity: 0.6;
		}
	}

	.tip-content {
		position: relative;
		padding: 0.25rem;
	}

	.tip-text-wrapper {
		position: relative;
		margin-bottom: 1rem;
	}

	.tip-content p {
		margin: 0;
		line-height: 1.8;
		color: #5a2e2e;
		font-size: 1.2rem;
		padding: 0.5rem;
		background: rgba(255, 255, 255, 0.95);
		border-radius: 16px;
		border: 1px solid rgba(209, 105, 30, 0.15);
		box-shadow:
			0 6px 20px rgba(0, 0, 0, 0.05),
			inset 0 1px 0 rgba(255, 255, 255, 0.8);
		position: relative;
		font-style: italic;
		font-weight: 500;
		transition: all 0.4s ease;
		min-height: 120px;
		display: flex;
		align-items: center;
	}

	.tip-content p:hover {
		background: white;
		box-shadow:
			0 8px 25px rgba(0, 0, 0, 0.08),
			inset 0 1px 0 rgba(255, 255, 255, 0.9);
		transform: translateY(-1px);
	}

	.quote-mark {
		position: absolute;
		font-size: 5rem;
		color: rgba(209, 105, 30, 0.2);
		font-family: Georgia, serif;
		line-height: 1;
		z-index: 1;
		transition: all 0.3s ease;
	}

	.quote-mark.start {
		top: -1.5rem;
		left: 0.5rem;
	}

	.quote-mark.end {
		bottom: -2.5rem;
		right: 0.5rem;
	}

	.tip-content p:hover ~ .quote-mark {
		color: rgba(209, 105, 30, 0.3);
		transform: scale(1.1);
	}

	/* Text animation classes */
	.tip-text-animate {
		animation: text-fade-in 0.6s ease-out;
	}

	.tip-text-out {
		animation: text-fade-out 0.3s ease-out forwards;
	}

	.tip-text-in {
		animation: text-fade-in 0.3s ease-out;
	}

	@keyframes text-fade-out {
		from {
			opacity: 1;
			transform: translateY(0) scale(1);
		}
		to {
			opacity: 0;
			transform: translateY(-10px) scale(0.95);
		}
	}

	@keyframes text-fade-in {
		from {
			opacity: 0;
			transform: translateY(10px) scale(0.95);
		}
		to {
			opacity: 1;
			transform: translateY(0) scale(1);
		}
	}

	.new-tip-btn {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 1rem;
		background: linear-gradient(
			135deg,
			var(--color-primary),
			var(--color-secondary)
		);
		color: white;
		border: none;
		border-radius: 14px;
		font-weight: 700;
		cursor: pointer;
		transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
		font-size: 1.1rem;
		box-shadow:
			0 8px 25px rgba(209, 105, 30, 0.3),
			0 2px 6px rgba(0, 0, 0, 0.1);
		position: relative;
		overflow: hidden;
	}

	.new-tip-btn::before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: linear-gradient(
			90deg,
			transparent,
			rgba(255, 255, 255, 0.2),
			transparent
		);
		transition: left 0.7s ease;
	}

	.new-tip-btn:hover {
		transform: translateY(-3px) scale(1.02);
		box-shadow:
			0 15px 35px rgba(209, 105, 30, 0.4),
			0 4px 8px rgba(0, 0, 0, 0.1);
		background: linear-gradient(
			135deg,
			var(--color-secondary),
			var(--color-primary)
		);
	}

	.new-tip-btn:hover::before {
		left: 100%;
	}

	.new-tip-btn:active {
		transform: translateY(-1px) scale(0.98);
	}

	.new-tip-btn:disabled {
		opacity: 0.7;
		cursor: not-allowed;
		transform: none !important;
	}

	.btn-icon svg {
		transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.new-tip-btn:hover .btn-icon svg {
		transform: rotate(180deg) scale(1.2);
	}

	.btn-spinner svg {
		animation: spin 0.75s linear infinite;
	}

	@keyframes spin {
		from {
			transform: rotate(0deg);
		}
		to {
			transform: rotate(360deg);
		}
	}

	.tip-counter {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		margin-top: 1.5rem;
		padding: 0.75rem 1.25rem;
		background: rgba(209, 105, 30, 0.08);
		border-radius: 10px;
		color: var(--color-primary);
		font-size: 0.9rem;
		font-weight: 500;
		border: 1px dashed rgba(209, 105, 30, 0.2);
		animation: float 3s ease-in-out infinite;
	}

	@keyframes float {
		0%,
		100% {
			transform: translateY(0);
		}
		50% {
			transform: translateY(-3px);
		}
	}

	.tip-counter svg {
		color: var(--color-secondary);
		animation: bounce 2s infinite;
	}

	@keyframes bounce {
		0%,
		100% {
			transform: translateY(0);
		}
		50% {
			transform: translateY(-3px);
		}
	}

	/* Confetti animation */
	.confetti {
		position: absolute;
		width: 10px;
		height: 10px;
		border-radius: 2px;
		animation: confetti-fall 1s ease-out forwards;
		z-index: 100;
	}

	@keyframes confetti-fall {
		0% {
			transform: translateY(-20px) rotate(0deg);
			opacity: 1;
		}
		100% {
			transform: translateY(100px) rotate(360deg);
			opacity: 0;
		}
	}

	@media (max-width: 768px) {
		.ai-tips-section {
			padding: 1.5rem;
			margin: 2rem 0;
		}

		.tip-header {
			flex-direction: column;
			text-align: center;
			gap: 1rem;
			padding-bottom: 1rem;
		}

		.tip-icon {
			align-self: center;
		}

		.tip-title {
			flex-direction: column;
			gap: 0.75rem;
		}

		.ai-tips-section h3 {
			font-size: 1.5rem;
			text-align: center;
		}

		.tip-content p {
			font-size: 1.1rem;
			padding: 1.5rem;
			min-height: 100px;
		}

		.new-tip-btn {
			width: 100%;
			justify-content: center;
			padding: 0.875rem 1.5rem;
		}

		.quote-mark.start {
			top: -1rem;
			left: 0.25rem;
			font-size: 4rem;
		}

		.quote-mark.end {
			bottom: -2rem;
			right: 0.25rem;
			font-size: 4rem;
		}
	}
</style>
